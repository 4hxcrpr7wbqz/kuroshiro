"use strict";function _interopDefault(a){return a&&"object"==typeof a&&"default"in a?a.default:a}var _regeneratorRuntime=_interopDefault(require("babel-runtime/regenerator")),asyncToGenerator=function(a){return function(){var u=a.apply(this,arguments);return new Promise(function(o,i){return function r(a,e){try{var n=u[a](e),t=n.value}catch(a){return void i(a)}if(!n.done)return Promise.resolve(t).then(function(a){r("next",a)},function(a){r("throw",a)});o(t)}("next")})}},classCallCheck=function(a,r){if(!(a instanceof r))throw new TypeError("Cannot call a class as a function")},createClass=function(){function n(a,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}}return function(a,r,e){return r&&n(a.prototype,r),e&&n(a,e),a}}(),toConsumableArray=function(a){if(Array.isArray(a)){for(var r=0,e=Array(a.length);r<a.length;r++)e[r]=a[r];return e}return Array.from(a)},KATAKANA_HIRAGANA_SHIFT="ぁ".charCodeAt(0)-"ァ".charCodeAt(0),HIRAGANA_KATAKANA_SHIFT="ァ".charCodeAt(0)-"ぁ".charCodeAt(0),isHiragana=function(a){return"぀"<=(a=a[0])&&a<="ゟ"},isKatakana=function(a){return"゠"<=(a=a[0])&&a<="ヿ"},isKanji=function(a){return"一"<=(a=a[0])&&a<="鿏"||"豈"<=a&&a<="﫿"||"㐀"<=a&&a<="䶿"},hasHiragana=function(a){for(var r=0;r<a.length;r++)if(isHiragana(a[r]))return!0;return!1},hasKatakana=function(a){for(var r=0;r<a.length;r++)if(isKatakana(a[r]))return!0;return!1},hasKanji=function(a){for(var r=0;r<a.length;r++)if(isKanji(a[r]))return!0;return!1},toRawHiragana=function(a){return[].concat(toConsumableArray(a)).map(function(a){return"゠"<a&&a<"ヷ"?String.fromCharCode(a.charCodeAt(0)+KATAKANA_HIRAGANA_SHIFT):a}).join("")},toRawKatakana=function(a){return[].concat(toConsumableArray(a)).map(function(a){return"぀"<a&&a<"゗"?String.fromCharCode(a.charCodeAt(0)+HIRAGANA_KATAKANA_SHIFT):a}).join("")},toRawRomaji=function(a){for(var r,e,n={"１":"1","２":"2","３":"3","４":"4","５":"5","６":"6","７":"7","８":"8","９":"9","０":"0","！":"!","”":'"',"＃":"#","＄":"$","％":"%","＆":"&","’":"'","（":"(","）":")","＝":"=","～":"~","｜":"|","＠":"@","‘":"`","＋":"+","＊":"*","；":";","：":":","＜":"<","＞":">","、":",","。":".","／":"/","？":"?","＿":"_","・":"･","「":"[","」":"]","｛":"{","｝":"}","￥":"\\","＾":"^","ふぁ":"fa","ふぃ":"fi","ふぇ":"fe","ふぉ":"fo","ファ":"fa","フィ":"fi","フェ":"fe","フォ":"fo","きゃ":"kya","きゅ":"kyu","きょ":"kyo","しゃ":"sha","しゅ":"shu","しょ":"sho","ちゃ":"cha","ちゅ":"chu","ちょ":"cho","にゃ":"nya","にゅ":"nyu","にょ":"nyo","ひゃ":"hya","ひゅ":"hyu","ひょ":"hyo","みゃ":"mya","みゅ":"myu","みょ":"myo","りゃ":"rya","りゅ":"ryu","りょ":"ryo","キャ":"kya","キュ":"kyu","キョ":"kyo","シャ":"sha","シュ":"shu","ショ":"sho","チャ":"cha","チュ":"chu","チョ":"cho","ニャ":"nya","ニュ":"nyu","ニョ":"nyo","ヒャ":"hya","ヒュ":"hyu","ヒョ":"hyo","ミャ":"mya","ミュ":"myu","ミョ":"myo","リャ":"rya","リュ":"ryu","リョ":"ryo","ふゃ":"fya","ふゅ":"fyu","ふょ":"fyo","ぴゃ":"pya","ぴゅ":"pyu","ぴょ":"pyo","びゃ":"bya","びゅ":"byu","びょ":"byo","ぢゃ":"dya","ぢゅ":"dyu","ぢょ":"dyo","じゃ":"ja","じゅ":"ju","じょ":"jo","ぎゃ":"gya","ぎゅ":"gyu","ぎょ":"gyo","フャ":"fya","フュ":"fyu","フョ":"fyo","ピャ":"pya","ピュ":"pyu","ピョ":"pyo","ビャ":"bya","ビュ":"byu","ビョ":"byo","ヂャ":"dya","ヂュ":"dyu","ヂョ":"dyo","ジャ":"ja","ジュ":"ju","ジョ":"jo","ギャ":"gya","ギュ":"gyu","ギョ":"gyo","ぱ":"pa","ぴ":"pi","ぷ":"pu","ぺ":"pe","ぽ":"po","ば":"ba","び":"bi","ぶ":"bu","べ":"be","ぼ":"bo","だ":"da","ぢ":"di","づ":"du","で":"de","ど":"do","ざ":"za","じ":"zi","ず":"zu","ぜ":"ze","ぞ":"zo","が":"ga","ぎ":"gi","ぐ":"gu","げ":"ge","ご":"go","パ":"pa","ピ":"pi","プ":"pu","ペ":"pe","ポ":"po","バ":"ba","ビ":"bi","ブ":"bu","ベ":"be","ボ":"bo","ダ":"da","ヂ":"di","ヅ":"du","デ":"de","ド":"do","ザ":"za","ジ":"zi","ズ":"zu","ゼ":"ze","ゾ":"zo","ガ":"ga","ギ":"gi","グ":"gu","ゲ":"ge","ゴ":"go","わ":"wa","ゐ":"wi","ゑ":"we","を":"wo","ら":"ra","り":"ri","る":"ru","れ":"re","ろ":"ro","や":"ya","ゆ":"yu","よ":"yo","ま":"ma","み":"mi","む":"mu","め":"me","も":"mo","は":"ha","ひ":"hi","ふ":"hu","へ":"he","ほ":"ho","な":"na","に":"ni","ぬ":"nu","ね":"ne","の":"no","た":"ta","ち":"ti","つ":"tu","て":"te","と":"to","さ":"sa","し":"si","す":"su","せ":"se","そ":"so","か":"ka","き":"ki","く":"ku","け":"ke","こ":"ko","あ":"a","い":"i","う":"u","え":"e","お":"o","ぁ":"a","ぃ":"i","ぅ":"u","ぇ":"e","ぉ":"o","ゃ":"ya","ゅ":"yu","ょ":"yo","ワ":"wa","ヰ":"wi","ヱ":"we","ヲ":"wo","ラ":"ra","リ":"ri","ル":"ru","レ":"re","ロ":"ro","ヤ":"ya","ユ":"yu","ヨ":"yo","マ":"ma","ミ":"mi","ム":"mu","メ":"me","モ":"mo","ハ":"ha","ヒ":"hi","フ":"hu","ヘ":"he","ホ":"ho","ナ":"na","ニ":"ni","ヌ":"nu","ネ":"ne","ノ":"no","タ":"ta","チ":"ti","ツ":"tu","テ":"te","ト":"to","サ":"sa","シ":"si","ス":"su","セ":"se","ソ":"so","カ":"ka","キ":"ki","ク":"ku","ケ":"ke","コ":"ko","ア":"a","イ":"i","ウ":"u","エ":"e","オ":"o","ァ":"a","ィ":"i","ゥ":"u","ェ":"e","ォ":"o","ャ":"ya","ュ":"yu","ョ":"yo","ヶ":"ke","ヵ":"ka","ん":"n","ー":"-","　":" "},t=0,o=a.length,i="";t<=o;)(e=n[a.substring(t,t+2)])?(i+=e,t+=2):(i+=(e=n[r=a.substring(t,t+1)])?e:r,t+=1);return i=(i=i.replace(/っ([bcdfghijklmnopqrstuvwyz])/gm,"$1$1")).replace(/っ/gm,"tu")},getStrType=function(a){for(var r=!1,e=!1,n=0;n<a.length;n++)isKanji(a[n])?r=!0:(isHiragana(a[n])||isKatakana(a[n]))&&(e=!0);return r&&e?1:r?0:e?2:3},splitObjArray=function(a,r,e){e=e||"";for(var n="",t=0;t<a.length;t++)t!==a.length-1?n+=a[t][r]+""+e:n+=a[t][r];return n},Kuroshiro=function(){function a(){classCallCheck(this,a),this._analyzer=null}var r;return createClass(a,[{key:"init",value:(r=asyncToGenerator(_regeneratorRuntime.mark(function a(r){var e;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(null!=(e=this)._analyzer){a.next=13;break}return a.prev=2,a.next=5,r.init();case 5:e._analyzer=r,a.next=11;break;case 8:throw a.prev=8,a.t0=a.catch(2),a.t0;case 11:a.next=14;break;case 13:throw new Error("Kuroshiro has already been initialized.");case 14:case"end":return a.stop()}},a,this,[[2,8]])})),function(a){return r.apply(this,arguments)})},{key:"convert",value:function(a,C,z){(C=C||{}).to=C.to||"hiragana",C.mode=C.mode||"normal",C.delimiter_start=C.delimiter_start||"(",C.delimiter_end=C.delimiter_end||")",a=a||"",this._analyzer.parse(a,function(a,r){if(a)return z(a);for(var e=0;e<r.length;e++)r[e].reading||(r[e].reading=r[e].surface_form);if("normal"===C.mode||"spaced"===C.mode)switch(C.to){case"katakana":return"normal"===C.mode?z(null,splitObjArray(r,"reading")):z(null,splitObjArray(r,"reading"," "));case"romaji":return"normal"===C.mode?z(null,toRawRomaji(splitObjArray(r,"reading"))):z(null,toRawRomaji(splitObjArray(r,"reading"," ")));case"hiragana":for(var n=0;n<r.length;n++)if(hasKanji(r[n].surface_form))if(hasKatakana(r[n].surface_form)){r[n].reading=toRawHiragana(r[n].reading);for(var t="",o="",i=0;i<r[n].surface_form.length;i++)isKanji(r[n].surface_form[i])?o+="(.*)":o+=isKatakana(r[n].surface_form[i])?toRawHiragana(r[n].surface_form[i]):r[n].surface_form[i];var u=new RegExp(o).exec(r[n].reading);if(u){for(var s=0,f=0;f<r[n].surface_form.length;f++)isKanji(r[n].surface_form[f])?(t+=u[s+1],s++):t+=r[n].surface_form[f];r[n].reading=t}}else r[n].reading=toRawHiragana(r[n].reading);else r[n].reading=r[n].surface_form;return"normal"===C.mode?z(null,splitObjArray(r,"reading")):z(null,splitObjArray(r,"reading"," "))}else{if("okurigana"!==C.mode&&"furigana"!==C.mode)return z(new Error("No such mode..."));for(var l=[],c=0;c<r.length;c++){switch(r[c].reading=toRawHiragana(r[c].reading),getStrType(r[c].surface_form)){case 0:l.push([r[c].surface_form,1,r[c].reading]);break;case 1:for(var y="",h=!1,m=[],g=0;g<r[c].surface_form.length;g++)isKanji(r[c].surface_form[g])?h?m[m.length-1]+=r[c].surface_form[g]:(h=!0,y+="(.*?)",m.push(r[c].surface_form[g])):(h=!1,m.push(r[c].surface_form[g]),y+=isKatakana(r[c].surface_form[g])?toRawHiragana(r[c].surface_form[g]):r[c].surface_form[g]);var d=new RegExp("^"+y+"$").exec(r[c].reading);if(d)for(var p=1,_=0;_<m.length;_++)isKanji(m[_][0])?l.push([m[_],1,d[p++]]):l.push([m[_],2,toRawHiragana(m[_])]);else l.push([r[c].surface_form,1,r[c].reading]);break;case 2:for(var k=0;k<r[c].surface_form.length;k++)l.push([r[c].surface_form[k],2,r[c].reading[k]]);break;case 3:for(var b=0;b<r[c].surface_form.length;b++)l.push([r[c].surface_form[b],3,r[c].surface_form[b]])}}var A="";switch(C.to){case"katakana":if("okurigana"===C.mode)for(var v=0;v<l.length;v++)1!==l[v][1]?A+=l[v][0]:A+=l[v][0]+C.delimiter_start+toRawKatakana(l[v][2])+C.delimiter_end;else for(var w=0;w<l.length;w++)1!==l[w][1]?A+=l[w][0]:A+="<ruby>"+l[w][0]+"<rp>"+C.delimiter_start+"</rp><rt>"+toRawKatakana(l[w][2])+"</rt><rp>"+C.delimiter_end+"</rp></ruby>";return z(null,A);case"romaji":if("okurigana"===C.mode)for(var K=0;K<l.length;K++)1!==l[K][1]?A+=l[K][0]:A+=l[K][0]+C.delimiter_start+toRawRomaji(l[K][2])+C.delimiter_end;else{A+="<ruby>";for(var j=0;j<l.length;j++)A+=l[j][0]+"<rp>"+C.delimiter_start+"</rp><rt>"+toRawRomaji(l[j][2])+"</rt><rp>"+C.delimiter_end+"</rp>";A+="</ruby>"}return z(null,A);case"hiragana":if("okurigana"===C.mode)for(var R=0;R<l.length;R++)1!==l[R][1]?A+=l[R][0]:A+=l[R][0]+C.delimiter_start+l[R][2]+C.delimiter_end;else for(var H=0;H<l.length;H++)1!==l[H][1]?A+=l[H][0]:A+="<ruby>"+l[H][0]+"<rp>"+C.delimiter_start+"</rp><rt>"+l[H][2]+"</rt><rp>"+C.delimiter_end+"</rp></ruby>";return z(null,A)}}})}}]),a}(),Util={hasHiragana:hasHiragana,hasKatakana:hasKatakana,hasKanji:hasKanji,isHiragana:isHiragana,isKatakana:isKatakana,isKanji:isKanji};Kuroshiro.Util=Util,module.exports=Kuroshiro;
//# sourceMappingURL=kuroshiro.js.map
