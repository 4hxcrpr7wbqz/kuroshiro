!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):r.kuroshiro=e()}(this,function(){"use strict";var r=function(r){if(Array.isArray(r)){for(var e=0,a=Array(r.length);e<r.length;e++)a[e]=r[e];return a}return Array.from(r)},e="ぁ".charCodeAt(0)-"ァ".charCodeAt(0),a="ァ".charCodeAt(0)-"ぁ".charCodeAt(0),n=function(r){return(r=r[0])>="぀"&&r<="ゟ"},o=function(r){return(r=r[0])>="゠"&&r<="ヿ"},t=function(r){return(r=r[0])>="一"&&r<="鿏"||r>="豈"&&r<="﫿"||r>="㐀"&&r<="䶿"},u=function(r){for(var e=0;e<r.length;e++)if(o(r[e]))return!0;return!1},i=function(r){for(var e=0;e<r.length;e++)if(t(r[e]))return!0;return!1},f=function(a){return[].concat(r(a)).map(function(r){return r>"゠"&&r<"ヷ"?String.fromCharCode(r.charCodeAt(0)+e):r}).join("")},s=function(e){return[].concat(r(e)).map(function(r){return r>"぀"&&r<"゗"?String.fromCharCode(r.charCodeAt(0)+a):r}).join("")},y=function(r){for(var e,a,n={"１":"1","２":"2","３":"3","４":"4","５":"5","６":"6","７":"7","８":"8","９":"9","０":"0","！":"!","”":'"',"＃":"#","＄":"$","％":"%","＆":"&","’":"'","（":"(","）":")","＝":"=","～":"~","｜":"|","＠":"@","‘":"`","＋":"+","＊":"*","；":";","：":":","＜":"<","＞":">","、":",","。":".","／":"/","？":"?","＿":"_","・":"･","「":"[","」":"]","｛":"{","｝":"}","￥":"\\","＾":"^","ふぁ":"fa","ふぃ":"fi","ふぇ":"fe","ふぉ":"fo","ファ":"fa","フィ":"fi","フェ":"fe","フォ":"fo","きゃ":"kya","きゅ":"kyu","きょ":"kyo","しゃ":"sha","しゅ":"shu","しょ":"sho","ちゃ":"cha","ちゅ":"chu","ちょ":"cho","にゃ":"nya","にゅ":"nyu","にょ":"nyo","ひゃ":"hya","ひゅ":"hyu","ひょ":"hyo","みゃ":"mya","みゅ":"myu","みょ":"myo","りゃ":"rya","りゅ":"ryu","りょ":"ryo","キャ":"kya","キュ":"kyu","キョ":"kyo","シャ":"sha","シュ":"shu","ショ":"sho","チャ":"cha","チュ":"chu","チョ":"cho","ニャ":"nya","ニュ":"nyu","ニョ":"nyo","ヒャ":"hya","ヒュ":"hyu","ヒョ":"hyo","ミャ":"mya","ミュ":"myu","ミョ":"myo","リャ":"rya","リュ":"ryu","リョ":"ryo","ふゃ":"fya","ふゅ":"fyu","ふょ":"fyo","ぴゃ":"pya","ぴゅ":"pyu","ぴょ":"pyo","びゃ":"bya","びゅ":"byu","びょ":"byo","ぢゃ":"dya","ぢゅ":"dyu","ぢょ":"dyo","じゃ":"ja","じゅ":"ju","じょ":"jo","ぎゃ":"gya","ぎゅ":"gyu","ぎょ":"gyo","フャ":"fya","フュ":"fyu","フョ":"fyo","ピャ":"pya","ピュ":"pyu","ピョ":"pyo","ビャ":"bya","ビュ":"byu","ビョ":"byo","ヂャ":"dya","ヂュ":"dyu","ヂョ":"dyo","ジャ":"ja","ジュ":"ju","ジョ":"jo","ギャ":"gya","ギュ":"gyu","ギョ":"gyo","ぱ":"pa","ぴ":"pi","ぷ":"pu","ぺ":"pe","ぽ":"po","ば":"ba","び":"bi","ぶ":"bu","べ":"be","ぼ":"bo","だ":"da","ぢ":"di","づ":"du","で":"de","ど":"do","ざ":"za","じ":"zi","ず":"zu","ぜ":"ze","ぞ":"zo","が":"ga","ぎ":"gi","ぐ":"gu","げ":"ge","ご":"go","パ":"pa","ピ":"pi","プ":"pu","ペ":"pe","ポ":"po","バ":"ba","ビ":"bi","ブ":"bu","ベ":"be","ボ":"bo","ダ":"da","ヂ":"di","ヅ":"du","デ":"de","ド":"do","ザ":"za","ジ":"zi","ズ":"zu","ゼ":"ze","ゾ":"zo","ガ":"ga","ギ":"gi","グ":"gu","ゲ":"ge","ゴ":"go","わ":"wa","ゐ":"wi","ゑ":"we","を":"wo","ら":"ra","り":"ri","る":"ru","れ":"re","ろ":"ro","や":"ya","ゆ":"yu","よ":"yo","ま":"ma","み":"mi","む":"mu","め":"me","も":"mo","は":"ha","ひ":"hi","ふ":"hu","へ":"he","ほ":"ho","な":"na","に":"ni","ぬ":"nu","ね":"ne","の":"no","た":"ta","ち":"ti","つ":"tu","て":"te","と":"to","さ":"sa","し":"si","す":"su","せ":"se","そ":"so","か":"ka","き":"ki","く":"ku","け":"ke","こ":"ko","あ":"a","い":"i","う":"u","え":"e","お":"o","ぁ":"a","ぃ":"i","ぅ":"u","ぇ":"e","ぉ":"o","ゃ":"ya","ゅ":"yu","ょ":"yo","ワ":"wa","ヰ":"wi","ヱ":"we","ヲ":"wo","ラ":"ra","リ":"ri","ル":"ru","レ":"re","ロ":"ro","ヤ":"ya","ユ":"yu","ヨ":"yo","マ":"ma","ミ":"mi","ム":"mu","メ":"me","モ":"mo","ハ":"ha","ヒ":"hi","フ":"hu","ヘ":"he","ホ":"ho","ナ":"na","ニ":"ni","ヌ":"nu","ネ":"ne","ノ":"no","タ":"ta","チ":"ti","ツ":"tu","テ":"te","ト":"to","サ":"sa","シ":"si","ス":"su","セ":"se","ソ":"so","カ":"ka","キ":"ki","ク":"ku","ケ":"ke","コ":"ko","ア":"a","イ":"i","ウ":"u","エ":"e","オ":"o","ァ":"a","ィ":"i","ゥ":"u","ェ":"e","ォ":"o","ャ":"ya","ュ":"yu","ョ":"yo","ヶ":"ke","ヵ":"ka","ん":"n","ー":"-","　":" "},o=0,t=r.length,u="";o<=t;)(a=n[r.substring(o,o+2)])?(u+=a,o+=2):(u+=(a=n[e=r.substring(o,o+1)])?a:e,o+=1);return u=(u=u.replace(/っ([bcdfghijklmnopqrstuvwyz])/gm,"$1$1")).replace(/っ/gm,"tu")},c=function(r){for(var e=!1,a=!1,u=0;u<r.length;u++)t(r[u])?e=!0:(n(r[u])||o(r[u]))&&(a=!0);return e&&a?1:e?0:a?2:3},d=function(r,e,a){a=a||"";for(var n="",o=0;o<r.length;o++)o!==r.length-1?n+=r[o][e]+""+a:n+=r[o][e];return n};function m(){this._analyzer=null}m.prototype.init=function(r,e){var a=this;null==a._analyzer?r.init(function(n){return n?e(n):(a._analyzer=r,e())}):e(new Error("Kuroshiro has already been initialized."))},m.prototype.convert=function(r,e,a){(e=e||{}).to=e.to||"hiragana",e.mode=e.mode||"normal",e.delimiter_start=e.delimiter_start||"(",e.delimiter_end=e.delimiter_end||")",r=r||"",this._analyzer.parse(r,function(r){for(var n=0;n<r.length;n++)r[n].reading||(r[n].reading=r[n].surface_form);if("normal"===e.mode||"spaced"===e.mode)switch(e.to){case"katakana":return"normal"===e.mode?a(null,d(r,"reading")):a(null,d(r,"reading"," "));case"romaji":return"normal"===e.mode?a(null,y(d(r,"reading"))):a(null,y(d(r,"reading"," ")));case"hiragana":for(var m=0;m<r.length;m++)if(i(r[m].surface_form))if(u(r[m].surface_form)){r[m].reading=f(r[m].reading);for(var h="",l="",g=0;g<r[m].surface_form.length;g++)t(r[m].surface_form[g])?l+="(.*)":l+=o(r[m].surface_form[g])?f(r[m].surface_form[g]):r[m].surface_form[g];var p=new RegExp(l).exec(r[m].reading);if(p){for(var _=0,k=0;k<r[m].surface_form.length;k++)t(r[m].surface_form[k])?(h+=p[_+1],_++):h+=r[m].surface_form[k];r[m].reading=h}}else r[m].reading=f(r[m].reading);else r[m].reading=r[m].surface_form;return"normal"===e.mode?a(null,d(r,"reading")):a(null,d(r,"reading"," "))}else{if("okurigana"!==e.mode&&"furigana"!==e.mode)return a(new Error("No such mode..."));for(var v=[],b=0;b<r.length;b++){switch(r[b].reading=f(r[b].reading),c(r[b].surface_form)){case 0:v.push([r[b].surface_form,1,r[b].reading]);break;case 1:for(var w="",j=!1,z=[],A=0;A<r[b].surface_form.length;A++)t(r[b].surface_form[A])?j?z[z.length-1]+=r[b].surface_form[A]:(j=!0,w+="(.*?)",z.push(r[b].surface_form[A])):(j=!1,z.push(r[b].surface_form[A]),w+=o(r[b].surface_form[A])?f(r[b].surface_form[A]):r[b].surface_form[A]);var C=new RegExp("^"+w+"$").exec(r[b].reading);if(C)for(var x=1,K=0;K<z.length;K++)t(z[K][0])?v.push([z[K],1,C[x++]]):v.push([z[K],2,f(z[K])]);else v.push([r[b].surface_form,1,r[b].reading]);break;case 2:for(var E=0;E<r[b].surface_form.length;E++)v.push([r[b].surface_form[E],2,r[b].reading[E]]);break;case 3:for(var $=0;$<r[b].surface_form.length;$++)v.push([r[b].surface_form[$],3,r[b].surface_form[$]])}}var H="";switch(e.to){case"katakana":if("okurigana"===e.mode)for(var R=0;R<v.length;R++)1!==v[R][1]?H+=v[R][0]:H+=v[R][0]+e.delimiter_start+s(v[R][2])+e.delimiter_end;else for(var S=0;S<v.length;S++)1!==v[S][1]?H+=v[S][0]:H+="<ruby>"+v[S][0]+"<rp>"+e.delimiter_start+"</rp><rt>"+s(v[S][2])+"</rt><rp>"+e.delimiter_end+"</rp></ruby>";return a(null,H);case"romaji":if("okurigana"===e.mode)for(var q=0;q<v.length;q++)1!==v[q][1]?H+=v[q][0]:H+=v[q][0]+e.delimiter_start+y(v[q][2])+e.delimiter_end;else{H+="<ruby>";for(var N=0;N<v.length;N++)H+=v[N][0]+"<rp>"+e.delimiter_start+"</rp><rt>"+y(v[N][2])+"</rt><rp>"+e.delimiter_end+"</rp>";H+="</ruby>"}return a(null,H);case"hiragana":if("okurigana"===e.mode)for(var B=0;B<v.length;B++)1!==v[B][1]?H+=v[B][0]:H+=v[B][0]+e.delimiter_start+v[B][2]+e.delimiter_end;else for(var D=0;D<v.length;D++)1!==v[D][1]?H+=v[D][0]:H+="<ruby>"+v[D][0]+"<rp>"+e.delimiter_start+"</rp><rt>"+v[D][2]+"</rt><rp>"+e.delimiter_end+"</rp></ruby>";return a(null,H)}}})},m.prototype.toHiragana=function(r,e,a){return(e=e||{}).to="hiragana",this.convert(r,e,a)},m.prototype.toKatakana=function(r,e,a){return(e=e||{}).to="katakana",this.convert(r,e,a)},m.prototype.toRomaji=function(r,e,a){return(e=e||{}).to="romaji",this.convert(r,e,a)};var h=new m;return h.hasHiragana=function(r){for(var e=0;e<r.length;e++)if(n(r[e]))return!0;return!1},h.hasKatakana=u,h.hasKanji=i,h.isHiragana=n,h.isKatakana=o,h.isKanji=t,h});
//# sourceMappingURL=kuroshiro.js.map
