!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):r.Kuroshiro=e()}(this,function(){"use strict";var r=function(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function r(r,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(e,a,n){return a&&r(e.prototype,a),n&&r(e,n),e}}(),a=function(r){if(Array.isArray(r)){for(var e=0,a=Array(r.length);e<r.length;e++)a[e]=r[e];return a}return Array.from(r)},n="ぁ".charCodeAt(0)-"ァ".charCodeAt(0),o="ァ".charCodeAt(0)-"ぁ".charCodeAt(0),t=function(r){return(r=r[0])>="぀"&&r<="ゟ"},u=function(r){return(r=r[0])>="゠"&&r<="ヿ"},i=function(r){return(r=r[0])>="一"&&r<="鿏"||r>="豈"&&r<="﫿"||r>="㐀"&&r<="䶿"},f=function(r){for(var e=0;e<r.length;e++)if(u(r[e]))return!0;return!1},s=function(r){for(var e=0;e<r.length;e++)if(i(r[e]))return!0;return!1},c=function(r){return[].concat(a(r)).map(function(r){return r>"゠"&&r<"ヷ"?String.fromCharCode(r.charCodeAt(0)+n):r}).join("")},l=function(r){return[].concat(a(r)).map(function(r){return r>"぀"&&r<"゗"?String.fromCharCode(r.charCodeAt(0)+o):r}).join("")},h=function(r){for(var e,a,n={"１":"1","２":"2","３":"3","４":"4","５":"5","６":"6","７":"7","８":"8","９":"9","０":"0","！":"!","”":'"',"＃":"#","＄":"$","％":"%","＆":"&","’":"'","（":"(","）":")","＝":"=","～":"~","｜":"|","＠":"@","‘":"`","＋":"+","＊":"*","；":";","：":":","＜":"<","＞":">","、":",","。":".","／":"/","？":"?","＿":"_","・":"･","「":"[","」":"]","｛":"{","｝":"}","￥":"\\","＾":"^","ふぁ":"fa","ふぃ":"fi","ふぇ":"fe","ふぉ":"fo","ファ":"fa","フィ":"fi","フェ":"fe","フォ":"fo","きゃ":"kya","きゅ":"kyu","きょ":"kyo","しゃ":"sha","しゅ":"shu","しょ":"sho","ちゃ":"cha","ちゅ":"chu","ちょ":"cho","にゃ":"nya","にゅ":"nyu","にょ":"nyo","ひゃ":"hya","ひゅ":"hyu","ひょ":"hyo","みゃ":"mya","みゅ":"myu","みょ":"myo","りゃ":"rya","りゅ":"ryu","りょ":"ryo","キャ":"kya","キュ":"kyu","キョ":"kyo","シャ":"sha","シュ":"shu","ショ":"sho","チャ":"cha","チュ":"chu","チョ":"cho","ニャ":"nya","ニュ":"nyu","ニョ":"nyo","ヒャ":"hya","ヒュ":"hyu","ヒョ":"hyo","ミャ":"mya","ミュ":"myu","ミョ":"myo","リャ":"rya","リュ":"ryu","リョ":"ryo","ふゃ":"fya","ふゅ":"fyu","ふょ":"fyo","ぴゃ":"pya","ぴゅ":"pyu","ぴょ":"pyo","びゃ":"bya","びゅ":"byu","びょ":"byo","ぢゃ":"dya","ぢゅ":"dyu","ぢょ":"dyo","じゃ":"ja","じゅ":"ju","じょ":"jo","ぎゃ":"gya","ぎゅ":"gyu","ぎょ":"gyo","フャ":"fya","フュ":"fyu","フョ":"fyo","ピャ":"pya","ピュ":"pyu","ピョ":"pyo","ビャ":"bya","ビュ":"byu","ビョ":"byo","ヂャ":"dya","ヂュ":"dyu","ヂョ":"dyo","ジャ":"ja","ジュ":"ju","ジョ":"jo","ギャ":"gya","ギュ":"gyu","ギョ":"gyo","ぱ":"pa","ぴ":"pi","ぷ":"pu","ぺ":"pe","ぽ":"po","ば":"ba","び":"bi","ぶ":"bu","べ":"be","ぼ":"bo","だ":"da","ぢ":"di","づ":"du","で":"de","ど":"do","ざ":"za","じ":"zi","ず":"zu","ぜ":"ze","ぞ":"zo","が":"ga","ぎ":"gi","ぐ":"gu","げ":"ge","ご":"go","パ":"pa","ピ":"pi","プ":"pu","ペ":"pe","ポ":"po","バ":"ba","ビ":"bi","ブ":"bu","ベ":"be","ボ":"bo","ダ":"da","ヂ":"di","ヅ":"du","デ":"de","ド":"do","ザ":"za","ジ":"zi","ズ":"zu","ゼ":"ze","ゾ":"zo","ガ":"ga","ギ":"gi","グ":"gu","ゲ":"ge","ゴ":"go","わ":"wa","ゐ":"wi","ゑ":"we","を":"wo","ら":"ra","り":"ri","る":"ru","れ":"re","ろ":"ro","や":"ya","ゆ":"yu","よ":"yo","ま":"ma","み":"mi","む":"mu","め":"me","も":"mo","は":"ha","ひ":"hi","ふ":"hu","へ":"he","ほ":"ho","な":"na","に":"ni","ぬ":"nu","ね":"ne","の":"no","た":"ta","ち":"ti","つ":"tu","て":"te","と":"to","さ":"sa","し":"si","す":"su","せ":"se","そ":"so","か":"ka","き":"ki","く":"ku","け":"ke","こ":"ko","あ":"a","い":"i","う":"u","え":"e","お":"o","ぁ":"a","ぃ":"i","ぅ":"u","ぇ":"e","ぉ":"o","ゃ":"ya","ゅ":"yu","ょ":"yo","ワ":"wa","ヰ":"wi","ヱ":"we","ヲ":"wo","ラ":"ra","リ":"ri","ル":"ru","レ":"re","ロ":"ro","ヤ":"ya","ユ":"yu","ヨ":"yo","マ":"ma","ミ":"mi","ム":"mu","メ":"me","モ":"mo","ハ":"ha","ヒ":"hi","フ":"hu","ヘ":"he","ホ":"ho","ナ":"na","ニ":"ni","ヌ":"nu","ネ":"ne","ノ":"no","タ":"ta","チ":"ti","ツ":"tu","テ":"te","ト":"to","サ":"sa","シ":"si","ス":"su","セ":"se","ソ":"so","カ":"ka","キ":"ki","ク":"ku","ケ":"ke","コ":"ko","ア":"a","イ":"i","ウ":"u","エ":"e","オ":"o","ァ":"a","ィ":"i","ゥ":"u","ェ":"e","ォ":"o","ャ":"ya","ュ":"yu","ョ":"yo","ヶ":"ke","ヵ":"ka","ん":"n","ー":"-","　":" "},o=0,t=r.length,u="";o<=t;)(a=n[r.substring(o,o+2)])?(u+=a,o+=2):(u+=(a=n[e=r.substring(o,o+1)])?a:e,o+=1);return u=(u=u.replace(/っ([bcdfghijklmnopqrstuvwyz])/gm,"$1$1")).replace(/っ/gm,"tu")},y=function(r){for(var e=!1,a=!1,n=0;n<r.length;n++)i(r[n])?e=!0:(t(r[n])||u(r[n]))&&(a=!0);return e&&a?1:e?0:a?2:3},d=function(r,e,a){a=a||"";for(var n="",o=0;o<r.length;o++)o!==r.length-1?n+=r[o][e]+""+a:n+=r[o][e];return n},m=function(){function a(){r(this,a),this._analyzer=null}return e(a,[{key:"init",value:function(){var r,e=(r=regeneratorRuntime.mark(function r(e){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=(a=this)._analyzer){r.next=13;break}return r.prev=2,r.next=5,e.init();case 5:a._analyzer=e,r.next=11;break;case 8:throw r.prev=8,r.t0=r.catch(2),r.t0;case 11:r.next=14;break;case 13:throw new Error("Kuroshiro has already been initialized.");case 14:case"end":return r.stop()}},r,this,[[2,8]])}),function(){var e=r.apply(this,arguments);return new Promise(function(r,a){return function n(o,t){try{var u=e[o](t),i=u.value}catch(r){return void a(r)}if(!u.done)return Promise.resolve(i).then(function(r){n("next",r)},function(r){n("throw",r)});r(i)}("next")})});return function(r){return e.apply(this,arguments)}}()},{key:"convert",value:function(r,e,a){(e=e||{}).to=e.to||"hiragana",e.mode=e.mode||"normal",e.delimiter_start=e.delimiter_start||"(",e.delimiter_end=e.delimiter_end||")",r=r||"",this._analyzer.parse(r,function(r,n){if(r)return a(r);for(var o=0;o<n.length;o++)n[o].reading||(n[o].reading=n[o].surface_form);if("normal"===e.mode||"spaced"===e.mode)switch(e.to){case"katakana":return"normal"===e.mode?a(null,d(n,"reading")):a(null,d(n,"reading"," "));case"romaji":return"normal"===e.mode?a(null,h(d(n,"reading"))):a(null,h(d(n,"reading"," ")));case"hiragana":for(var t=0;t<n.length;t++)if(s(n[t].surface_form))if(f(n[t].surface_form)){n[t].reading=c(n[t].reading);for(var m="",g="",p=0;p<n[t].surface_form.length;p++)i(n[t].surface_form[p])?g+="(.*)":g+=u(n[t].surface_form[p])?c(n[t].surface_form[p]):n[t].surface_form[p];var _=new RegExp(g).exec(n[t].reading);if(_){for(var v=0,k=0;k<n[t].surface_form.length;k++)i(n[t].surface_form[k])?(m+=_[v+1],v++):m+=n[t].surface_form[k];n[t].reading=m}}else n[t].reading=c(n[t].reading);else n[t].reading=n[t].surface_form;return"normal"===e.mode?a(null,d(n,"reading")):a(null,d(n,"reading"," "))}else{if("okurigana"!==e.mode&&"furigana"!==e.mode)return a(new Error("No such mode..."));for(var b=[],w=0;w<n.length;w++){switch(n[w].reading=c(n[w].reading),y(n[w].surface_form)){case 0:b.push([n[w].surface_form,1,n[w].reading]);break;case 1:for(var z="",j=!1,x=[],C=0;C<n[w].surface_form.length;C++)i(n[w].surface_form[C])?j?x[x.length-1]+=n[w].surface_form[C]:(j=!0,z+="(.*?)",x.push(n[w].surface_form[C])):(j=!1,x.push(n[w].surface_form[C]),z+=u(n[w].surface_form[C])?c(n[w].surface_form[C]):n[w].surface_form[C]);var A=new RegExp("^"+z+"$").exec(n[w].reading);if(A)for(var K=1,E=0;E<x.length;E++)i(x[E][0])?b.push([x[E],1,A[K++]]):b.push([x[E],2,c(x[E])]);else b.push([n[w].surface_form,1,n[w].reading]);break;case 2:for(var R=0;R<n[w].surface_form.length;R++)b.push([n[w].surface_form[R],2,n[w].reading[R]]);break;case 3:for(var $=0;$<n[w].surface_form.length;$++)b.push([n[w].surface_form[$],3,n[w].surface_form[$]])}}var P="";switch(e.to){case"katakana":if("okurigana"===e.mode)for(var H=0;H<b.length;H++)1!==b[H][1]?P+=b[H][0]:P+=b[H][0]+e.delimiter_start+l(b[H][2])+e.delimiter_end;else for(var S=0;S<b.length;S++)1!==b[S][1]?P+=b[S][0]:P+="<ruby>"+b[S][0]+"<rp>"+e.delimiter_start+"</rp><rt>"+l(b[S][2])+"</rt><rp>"+e.delimiter_end+"</rp></ruby>";return a(null,P);case"romaji":if("okurigana"===e.mode)for(var q=0;q<b.length;q++)1!==b[q][1]?P+=b[q][0]:P+=b[q][0]+e.delimiter_start+h(b[q][2])+e.delimiter_end;else{P+="<ruby>";for(var N=0;N<b.length;N++)P+=b[N][0]+"<rp>"+e.delimiter_start+"</rp><rt>"+h(b[N][2])+"</rt><rp>"+e.delimiter_end+"</rp>";P+="</ruby>"}return a(null,P);case"hiragana":if("okurigana"===e.mode)for(var O=0;O<b.length;O++)1!==b[O][1]?P+=b[O][0]:P+=b[O][0]+e.delimiter_start+b[O][2]+e.delimiter_end;else for(var T=0;T<b.length;T++)1!==b[T][1]?P+=b[T][0]:P+="<ruby>"+b[T][0]+"<rp>"+e.delimiter_start+"</rp><rt>"+b[T][2]+"</rt><rp>"+e.delimiter_end+"</rp></ruby>";return a(null,P)}}})}}]),a}(),g={hasHiragana:function(r){for(var e=0;e<r.length;e++)if(t(r[e]))return!0;return!1},hasKatakana:f,hasKanji:s,isHiragana:t,isKatakana:u,isKanji:i};return m.Util=g,m});
//# sourceMappingURL=kuroshiro.js.map
